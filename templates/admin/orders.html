<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è - RepairHub Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        .order-row {
            transition: background-color 0.2s;
        }
        .order-row:hover {
            background-color: #f8f9fa;
        }
        .status-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
        }
        .pagination .page-item.active .page-link {
            background-color: #0d6efd;
            border-color: #0d6efd;
        }
        .filter-sidebar {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
        }
        .export-btn {
            min-width: 120px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="/admin/">RepairHub Admin</a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/">–ì–æ–ª–æ–≤–Ω–∞</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/repairs">–†–µ–º–æ–Ω—Ç–∏</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/admin/orders">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/users">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ</a>
                    </li>
                </ul>
                <div class="d-flex">
                    <span class="navbar-text me-3">–ê–¥–º—ñ–Ω: {{ current_user.username }}</span>
                    <a href="/" class="btn btn-outline-light btn-sm">–ù–∞ —Å–∞–π—Ç</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="row">
            <!-- –§—ñ–ª—å—Ç—Ä–∏ -->
            <div class="col-md-3 mb-4">
                <div class="filter-sidebar">
                    <h5 class="mb-3">üîç –§—ñ–ª—å—Ç—Ä–∏ –∑–∞–º–æ–≤–ª–µ–Ω—å</h5>
                    
                    <!-- –ü–æ—à—É–∫ -->
                    <form method="get" action="/admin/orders/search" class="mb-3">
                        <div class="mb-3">
                            <label class="form-label">–ü–æ—à—É–∫</label>
                            <input type="text" 
                                   class="form-control" 
                                   name="query" 
                                   placeholder="–Ü–º'—è, —Ç–µ–ª–µ—Ñ–æ–Ω, email..."
                                   value="{{ search_query or '' }}">
                        </div>
                        
                        <!-- –°—Ç–∞—Ç—É—Å -->
                        <div class="mb-3">
                            <label class="form-label">–°—Ç–∞—Ç—É—Å</label>
                            <select class="form-select" name="status">
                                <option value="all">–í—Å—ñ —Å—Ç–∞—Ç—É—Å–∏</option>
                                {% for status in statuses %}
                                <option value="{{ status.value }}" 
                                        {% if selected_status == status.value %}selected{% endif %}>
                                    {{ status.value }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <!-- –î–∞—Ç–∞ -->
                        <div class="mb-3">
                            <label class="form-label">–î–∞—Ç–∞ –≤—ñ–¥</label>
                            <input type="date" 
                                   class="form-control" 
                                   name="date_from"
                                   value="{{ date_from or '' }}">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">–î–∞—Ç–∞ –¥–æ</label>
                            <input type="date" 
                                   class="form-control" 
                                   name="date_to"
                                   value="{{ date_to or '' }}">
                        </div>
                        
                        <!-- –°—É–º–º–∞ -->
                        <div class="mb-3">
                            <label class="form-label">–°—É–º–∞, –≥—Ä–Ω</label>
                            <div class="row g-2">
                                <div class="col">
                                    <input type="number" 
                                           class="form-control" 
                                           name="min_amount" 
                                           placeholder="–í—ñ–¥"
                                           value="{{ min_amount or '' }}">
                                </div>
                                <div class="col">
                                    <input type="number" 
                                           class="form-control" 
                                           name="max_amount" 
                                           placeholder="–î–æ"
                                           value="{{ max_amount or '' }}">
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-search"></i> –ü–æ—à—É–∫
                            </button>
                            <a href="/admin/orders" class="btn btn-outline-secondary">
                                <i class="bi bi-x-circle"></i> –°–∫–∏–Ω—É—Ç–∏
                            </a>
                        </div>
                    </form>
                    
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                    <div class="mt-4 pt-3 border-top">
                        <h6 class="mb-2">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h6>
                        <ul class="list-unstyled small">
                            <li class="mb-1">
                                <strong>–í—Å—å–æ–≥–æ:</strong> {{ total_count or orders|length }}
                            </li>
                            <li class="mb-1">
                                <strong>–ù–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ:</strong> {{ per_page or 20 }}
                            </li>
                            {% if total_pages %}
                            <li class="mb-1">
                                <strong>–°—Ç–æ—Ä—ñ–Ω–æ–∫:</strong> {{ total_pages }}
                            </li>
                            {% endif %}
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- –°–ø–∏—Å–æ–∫ –∑–∞–º–æ–≤–ª–µ–Ω—å -->
            <div class="col-md-9">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h1>–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</h1>
                    
                    <div class="btn-group">
                        <a href="/admin/orders" class="btn btn-outline-primary {% if not selected_status %}active{% endif %}">
                            –í—Å—ñ
                        </a>
                        {% for status in statuses %}
                        <a href="/admin/orders?status={{ status.value }}" 
                           class="btn btn-outline-primary {% if selected_status == status.value %}active{% endif %}">
                            {{ status.value }}
                        </a>
                        {% endfor %}
                    </div>
                </div>

                <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –ø–æ—à—É–∫ -->
                {% if search_query or date_from or date_to or min_amount or max_amount %}
                <div class="alert alert-info mb-4">
                    <h6>üîç –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–æ—à—É–∫—É:</h6>
                    <div class="small">
                        {% if search_query %}–ü–æ—à—É–∫: "{{ search_query }}"{% endif %}
                        {% if date_from %} | –í—ñ–¥: {{ date_from }}{% endif %}
                        {% if date_to %} | –î–æ: {{ date_to }}{% endif %}
                        {% if min_amount %} | –°—É–º–∞ –≤—ñ–¥: {{ min_amount }} –≥—Ä–Ω{% endif %}
                        {% if max_amount %} | –°—É–º–∞ –¥–æ: {{ max_amount }} –≥—Ä–Ω{% endif %}
                        {% if selected_status and selected_status != "all" %} | –°—Ç–∞—Ç—É—Å: {{ selected_status }}{% endif %}
                    </div>
                </div>
                {% endif %}

                {% if orders %}
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>ID</th>
                                <th>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á</th>
                                <th>–î–∞—Ç–∞</th>
                                <th>–°—É–º–∞</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–ö–ª—ñ—î–Ω—Ç</th>
                                <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                <th>–î—ñ—ó</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for order in orders %}
                            <tr class="order-row">
                                <td><strong>#{{ order.id }}</strong></td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center me-2" 
                                             style="width: 30px; height: 30px; font-size: 0.8rem;">
                                            {{ order.user.username[0]|upper }}
                                        </div>
                                        <div>
                                            <div class="small">{{ order.user.username }}</div>
                                            <div class="text-muted extra-small">{{ order.user.email }}</div>
                                        </div>
                                    </div>
                                </td>
                                <td>{{ order.created_at.strftime('%d.%m.%Y %H:%M') }}</td>
                                <td>
                                    <strong>{{ order.total_amount }} –≥—Ä–Ω</strong>
                                    <div class="text-muted extra-small">
                                        {{ order.items|length }} —Ç–æ–≤–∞—Ä(—ñ–≤)
                                    </div>
                                </td>
                                <td>
                                    {% if order.status.value == "–ù–æ–≤–∏–π" %}
                                        <span class="badge bg-warning status-badge">{{ order.status.value }}</span>
                                    {% elif order.status.value == "–í –æ–±—Ä–æ–±—Ü—ñ" %}
                                        <span class="badge bg-info status-badge">{{ order.status.value }}</span>
                                    {% elif order.status.value == "–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ" %}
                                        <span class="badge bg-primary status-badge">{{ order.status.value }}</span>
                                    {% elif order.status.value == "–ì–æ—Ç—É—î—Ç—å—Å—è" %}
                                        <span class="badge bg-secondary status-badge">{{ order.status.value }}</span>
                                    {% elif order.status.value == "–ì–æ—Ç–æ–≤–∏–π" %}
                                        <span class="badge bg-success status-badge">{{ order.status.value }}</span>
                                    {% elif order.status.value == "–í –¥–æ—Ä–æ–∑—ñ" %}
                                        <span class="badge bg-primary status-badge">{{ order.status.value }}</span>
                                    {% elif order.status.value == "–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ" %}
                                        <span class="badge bg-success status-badge">{{ order.status.value }}</span>
                                    {% elif order.status.value == "–°–∫–∞—Å–æ–≤–∞–Ω–æ" %}
                                        <span class="badge bg-danger status-badge">{{ order.status.value }}</span>
                                    {% else %}
                                        <span class="badge bg-secondary status-badge">{{ order.status.value }}</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {{ order.customer_name }}
                                    <div class="text-muted extra-small">
                                        {{ order.customer_email }}
                                    </div>
                                </td>
                                <td>{{ order.customer_phone }}</td>
                                <td>
                                    <div class="btn-group btn-group-sm" role="group">
                                        <a href="/admin/order/{{ order.id }}" 
                                           class="btn btn-outline-primary" 
                                           title="–î–µ—Ç–∞–ª—ñ">
                                            <i class="bi bi-eye"></i>
                                        </a>
                                        <a href="tel:{{ order.customer_phone }}" 
                                           class="btn btn-outline-success" 
                                           title="–ó–∞—Ç–µ–ª–µ—Ñ–æ–Ω—É–≤–∞—Ç–∏">
                                            <i class="bi bi-telephone"></i>
                                        </a>
                                        <a href="mailto:{{ order.customer_email }}" 
                                           class="btn btn-outline-info" 
                                           title="–ù–∞–ø–∏—Å–∞—Ç–∏ email">
                                            <i class="bi bi-envelope"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                <!-- –ü–∞–≥—ñ–Ω–∞—Ü—ñ—è -->
                {% if total_pages and total_pages > 1 %}
                <nav aria-label="–ù–∞–≤—ñ–≥–∞—Ü—ñ—è –ø–æ —Å—Ç–æ—Ä—ñ–Ω–∫–∞–º" class="mt-4">
                    <ul class="pagination justify-content-center">
                        {% if page > 1 %}
                        <li class="page-item">
                            <a class="page-link" href="/admin/orders?page={{ page-1 }}{% if selected_status %}&status={{ selected_status }}{% endif %}">
                                <i class="bi bi-chevron-left"></i>
                            </a>
                        </li>
                        {% endif %}
                        
                        {% for p in range(1, total_pages + 1) %}
                            {% if p >= page-2 and p <= page+2 %}
                            <li class="page-item {% if p == page %}active{% endif %}">
                                <a class="page-link" href="/admin/orders?page={{ p }}{% if selected_status %}&status={{ selected_status }}{% endif %}">
                                    {{ p }}
                                </a>
                            </li>
                            {% endif %}
                        {% endfor %}
                        
                        {% if page < total_pages %}
                        <li class="page-item">
                            <a class="page-link" href="/admin/orders?page={{ page+1 }}{% if selected_status %}&status={{ selected_status }}{% endif %}">
                                <i class="bi bi-chevron-right"></i>
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </nav>
                {% endif %}

                <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Å—Ç–æ—Ä—ñ–Ω–∫—É -->
                <div class="text-center text-muted small mt-3">
                    –°—Ç–æ—Ä—ñ–Ω–∫–∞ {{ page }} –∑ {{ total_pages or 1 }} ‚Ä¢ 
                    –ü–æ–∫–∞–∑–∞–Ω–æ {{ orders|length }} –∑ {{ total_count or orders|length }} –∑–∞–º–æ–≤–ª–µ–Ω—å
                </div>
                
                {% else %}
                <div class="alert alert-info text-center py-5">
                    <div class="mb-3">
                        <i class="bi bi-cart-x" style="font-size: 3rem;"></i>
                    </div>
                    <h4 class="alert-heading">–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –≤—ñ–¥—Å—É—Ç–Ω—ñ</h4>
                    <p>–ù–∞—Ä–∞–∑—ñ –Ω–µ–º–∞—î –∑–∞–º–æ–≤–ª–µ–Ω—å{% if selected_status %} –∑—ñ —Å—Ç–∞—Ç—É—Å–æ–º "{{ selected_status }}"{% endif %}.</p>
                    <a href="/admin/orders" class="btn btn-primary">–ü–æ–∫–∞–∑–∞—Ç–∏ –≤—Å—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <footer class="bg-dark text-white py-3 mt-4">
        <div class="container text-center">
            <small>RepairHub Admin Panel ‚Ä¢ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è ‚Ä¢ –°—Ç–æ—Ä—ñ–Ω–∫–∞ {{ page }}</small>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞
            const statusSelect = document.querySelector('select[name="status"]');
            if (statusSelect) {
                statusSelect.addEventListener('change', function() {
                    const form = this.closest('form');
                    const currentUrl = new URL(window.location);
                    const status = this.value;
                    
                    if (status === 'all') {
                        window.location.href = '/admin/orders';
                    } else {
                        window.location.href = `/admin/orders?status=${status}`;
                    }
                });
            }
            
            // –≠–∫—Å–ø–æ—Ä—Ç –∑–∞–∫–∞–∑–æ–≤ (–∑–∞–≥–ª—É—à–∫–∞)
            const exportButtons = document.querySelectorAll('.export-btn');
            exportButtons.forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    alert('–ï–∫—Å–ø–æ—Ä—Ç –∑–∞–º–æ–≤–ª–µ–Ω—å –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π —É –Ω–∞—Å—Ç—É–ø–Ω—ñ–π –≤–µ—Ä—Å—ñ—ó');
                });
            });
            
            // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å—Ç—Ä–æ–∫ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
            const orderRows = document.querySelectorAll('.order-row');
            orderRows.forEach(row => {
                row.addEventListener('click', function(e) {
                    if (!e.target.closest('a') && !e.target.closest('button')) {
                        const orderId = this.querySelector('td strong').textContent.replace('#', '');
                        window.location.href = `/admin/order/${orderId}`;
                    }
                });
            });
        });
    </script>
</body>
</html>