<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∞–≥–∞–∑–∏–Ω - RepairHub</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        .product-card {
            transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid #e9ecef;
            height: 100%;
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .product-img {
            height: 200px;
            object-fit: cover;
            width: 100%;
        }
        .price {
            color: #198754;
            font-weight: bold;
            font-size: 1.2rem;
        }
        .category-badge {
            cursor: pointer;
        }
        .stock-badge {
            font-size: 0.8rem;
        }
        .filter-sidebar {
            position: sticky;
            top: 20px;
        }
    </style>
</head>
<body class="bg-light">
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="navbar navbar-expand-lg navbar-white bg-white border-bottom shadow-sm">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center gap-2" href="/">
                <div class="rounded bg-primary text-white d-flex align-items-center justify-content-center" 
                     style="width:40px;height:40px;font-weight:700;">R</div>
                <div>
                    <div class="fw-bold">RepairHub</div>
                    <div class="text-muted small">–ú–∞–≥–∞–∑–∏–Ω —Ç–µ—Ö–Ω—ñ–∫–∏</div>
                </div>
            </a>
            
            <div class="ms-auto d-flex gap-3">
                <a href="/" class="btn btn-link">–ì–æ–ª–æ–≤–Ω–∞</a>
                <a href="/products" class="btn btn-link active">–ú–∞–≥–∞–∑–∏–Ω</a>
                {% if is_authenticated %}
                    <a href="/account/dashboard" class="btn btn-outline-primary">–ö–∞–±—ñ–Ω–µ—Ç</a>
                {% else %}
                    <a href="/auth/login" class="btn btn-outline-secondary">–£–≤—ñ–π—Ç–∏</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <main class="container my-4">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>üõí –ú–∞–≥–∞–∑–∏–Ω —Ç–µ—Ö–Ω—ñ–∫–∏</h1>
            <div class="text-muted">
                –ó–Ω–∞–π–¥–µ–Ω–æ: {{ products|length }} —Ç–æ–≤–∞—Ä—ñ–≤
            </div>
        </div>
        
        <div class="row">
            <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - —Ñ–∏–ª—å—Ç—Ä—ã -->
            <div class="col-lg-3 mb-4">
                <div class="card filter-sidebar">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">üîç –§—ñ–ª—å—Ç—Ä–∏</h5>
                    </div>
                    <div class="card-body">
                        <form method="get" id="filter-form">
                            <!-- –ü–æ–∏—Å–∫ -->
                            <div class="mb-3">
                                <label class="form-label">–ü–æ—à—É–∫ —Ç–æ–≤–∞—Ä—É</label>
                                <input type="text" 
                                       class="form-control" 
                                       name="search" 
                                       value="{{ search_query or '' }}"
                                       placeholder="–ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É...">
                            </div>
                            
                            <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
                            <div class="mb-3">
                                <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</label>
                                <select class="form-select" name="category">
                                    <option value="">–í—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</option>
                                    {% for cat in categories %}
                                    <option value="{{ cat.value }}" 
                                            {% if selected_category == cat.value %}selected{% endif %}>
                                        {{ cat.value }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <!-- –¶–µ–Ω–∞ -->
                            <div class="mb-4">
                                <label class="form-label">–¶—ñ–Ω–∞, –≥—Ä–Ω</label>
                                <div class="row g-2">
                                    <div class="col">
                                        <input type="number" 
                                               class="form-control" 
                                               name="min_price" 
                                               placeholder="–í—ñ–¥"
                                               value="{{ min_price or '' }}">
                                    </div>
                                    <div class="col">
                                        <input type="number" 
                                               class="form-control" 
                                               name="max_price" 
                                               placeholder="–î–æ"
                                               value="{{ max_price or '' }}">
                                    </div>
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-100 mb-2">
                                <i class="bi bi-funnel me-1"></i> –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏
                            </button>
                            <a href="/products" class="btn btn-outline-secondary w-100">
                                <i class="bi bi-x-circle me-1"></i> –°–∫–∏–Ω—É—Ç–∏
                            </a>
                        </form>
                    </div>
                    
                    <!-- –ë—ã—Å—Ç—Ä—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
                    <div class="card-footer">
                        <h6 class="mb-2">üè∑Ô∏è –®–≤–∏–¥–∫–∏–π –≤–∏–±—ñ—Ä:</h6>
                        <div class="d-flex flex-wrap gap-1">
                            {% for cat in categories[:6] %}
                            <a href="/products?category={{ cat.value }}" 
                               class="badge bg-light text-dark text-decoration-none category-badge">
                                {{ cat.value }}
                            </a>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - —Ç–æ–≤–∞—Ä—ã -->
            <div class="col-lg-9">
                {% if products %}
                <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                    {% for product in products %}
                    <div class="col">
                        <div class="card product-card h-100">
                            <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ -->
                            <div class="position-relative">
                                {% if product.image_url %}
                                <img src="{{ product.image_url }}" 
                                     class="card-img-top product-img" 
                                     alt="{{ product.name }}"
                                     onerror="this.src='https://via.placeholder.com/300x200?text=–¢–æ–≤–∞—Ä'">
                                {% else %}
                                <div class="product-img bg-secondary d-flex align-items-center justify-content-center">
                                    <i class="bi bi-image text-white fs-1"></i>
                                </div>
                                {% endif %}
                                
                                <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
                                <span class="position-absolute top-0 start-0 m-2 badge bg-info">
                                    {{ product.category.value }}
                                </span>
                                
                                <!-- –ù–∞–ª–∏—á–∏–µ -->
                                <span class="position-absolute top-0 end-0 m-2 badge {% if product.stock_quantity > 0 %}bg-success{% else %}bg-danger{% endif %} stock-badge">
                                    {% if product.stock_quantity > 0 %}
                                    {{ product.stock_quantity }} —à—Ç.
                                    {% else %}
                                    –ù–µ–º–∞—î
                                    {% endif %}
                                </span>
                            </div>
                            
                            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">{{ product.name }}</h5>
                                <p class="card-text text-muted small flex-grow-1">
                                    {{ product.description|truncate(100) }}
                                </p>
                                
                                <div class="mt-auto">
                                    <!-- –¶–µ–Ω–∞ -->
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <span class="price">{{ product.price|round(2) }} –≥—Ä–Ω</span>
                                        <small class="text-muted">ID: {{ product.id }}</small>
                                    </div>
                                    
                                    <!-- –ö–Ω–æ–ø–∫–∏ -->
                                    <div class="d-grid gap-2">
                                        <a href="/product/{{ product.id }}" 
                                           class="btn btn-outline-primary">
                                            <i class="bi bi-eye me-1"></i> –î–µ—Ç–∞–ª—å–Ω—ñ—à–µ
                                        </a>
                                        {% if product.stock_quantity > 0 %}
                                        <form method="post" action="/cart/add" class="d-inline">
                                            <input type="hidden" name="product_id" value="{{ product.id }}">
                                            <button type="submit" class="btn btn-success w-100">
                                                <i class="bi bi-cart-plus me-1"></i> –í –∫–æ—à–∏–∫
                                            </button>
                                        </form>
                                        {% else %}
                                        <button class="btn btn-secondary w-100" disabled>
                                            <i class="bi bi-x-circle me-1"></i> –ù–µ–º–∞—î –≤ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ
                                        </button>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- –î–∞—Ç–∞ -->
                            <div class="card-footer text-muted small">
                                <i class="bi bi-calendar me-1"></i>
                                –î–æ–¥–∞–Ω–æ: {{ product.created_at.strftime('%d.%m.%Y') }}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <!-- –°–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ—Ç -->
                <div class="text-center py-5">
                    <div class="display-1 text-muted mb-4">üòï</div>
                    <h3 class="mb-3">–¢–æ–≤–∞—Ä–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω—ñ</h3>
                    <p class="text-muted mb-4">
                        –°–ø—Ä–æ–±—É–π—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ –∞–±–æ –∑–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞.
                    </p>
                    <a href="/products" class="btn btn-primary">
                        <i class="bi bi-arrow-clockwise me-1"></i> –ü–æ–∫–∞–∑–∞—Ç–∏ –≤—Å—ñ —Ç–æ–≤–∞—Ä–∏
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </main>

    <!-- –ü–æ–¥–≤–∞–ª -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container text-center">
            <div class="mb-2">
                <a href="/" class="text-white text-decoration-none me-3">–ì–æ–ª–æ–≤–Ω–∞</a>
                <a href="/products" class="text-white text-decoration-none me-3">–ú–∞–≥–∞–∑–∏–Ω</a>
                <a href="/account/dashboard" class="text-white text-decoration-none me-3">–ö–∞–±—ñ–Ω–µ—Ç</a>
                <a href="/auth/register" class="text-white text-decoration-none">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</a>
            </div>
            <div class="text-muted small">
                ¬© {{ now.year if now else "2024" }} RepairHub ‚Ä¢ –ú–∞–≥–∞–∑–∏–Ω —Ç–µ—Ö–Ω—ñ–∫–∏
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        document.querySelectorAll('#filter-form select').forEach(select => {
            select.addEventListener('change', function() {
                document.getElementById('filter-form').submit();
            });
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ —Ü–µ–Ω—ã
        document.addEventListener('DOMContentLoaded', function() {
            const filterForm = document.getElementById('filter-form');
            
            // –î–ª—è –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ —Ü–µ–Ω—ã - –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞
            document.querySelectorAll('input[name="min_price"], input[name="max_price"]').forEach(input => {
                input.addEventListener('blur', function() {
                    if (this.value !== '') {
                        filterForm.submit();
                    }
                });
            });
            
            // –î–ª—è –ø–æ–ª—è –ø–æ–∏—Å–∫–∞ - –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Enter
            document.querySelector('input[name="search"]').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    filterForm.submit();
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≥–æ–¥ –≤ –ø–æ–¥–≤–∞–ª–µ
            const footer = document.querySelector('footer .text-muted');
            if (footer && footer.textContent.includes('{{ now.year if now else "2024" }}')) {
                const currentYear = new Date().getFullYear();
                footer.innerHTML = footer.innerHTML.replace('{{ now.year if now else "2024" }}', currentYear);
            }
        });
    </script>
</body>
</html>